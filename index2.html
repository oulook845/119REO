<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        height: 100%;
      }
      section {
        width: 100%;
        height: 100vh;
        background: #111;
        color:#fff;
        position: relative;
      }
      #con1 {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2rem;
      }
      section#video_sec {
        background: #eee;
      }
      #bound-one::before{
        content: "";
        display: block;
        width: 100%;
        height: 150px;
        background: linear-gradient(0deg, rgba(0,0,0,0) 20%, rgba(17,17,17,1) 100%);

        position: absolute;
        left: 0;
        top:0;
      }
      #bound-one {
        width: 100%;
        height: 100vh;
        background: #111;
        margin: 0 auto;
        position: sticky; /* 미리 sticky 설정 */
        top: 0; /* 화면 상단에 고정 */
      }
      video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center bottom;
        transition: opacity 0.75s;
      }
      footer{
        width: 100%;
        height: 400px;
        background: #111;
      }
    </style>
  </head>
  <body>
    <section id="con1">content_01</section>
    <section id="video_sec">
      <div id="bound-one">
        <video src="./video/main/main_makingFilm.mp4" width="100%"></video>
      </div>
    </section>
    <footer></footer>

    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@latest/bundled/lenis.min.js"></script>

    <script>
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => (t === 1 ? 1 : 1 - Math.pow(2, -10 * t)),
        direction: "vertical",
        smooth: true,
        smoothTouch: false,
      });

      const video_sect = document.getElementById("video_sec");
      const video = document.querySelector("#bound-one video");

      let video_sect_top;
      let video_sect_height;

      // 비디오 메타데이터 로드 후 높이 계산
      video.addEventListener("loadedmetadata", () => {
        const heightPerSecond = 100; // 조절 가능
        video_sect_height = video.duration * heightPerSecond;

        // 추가 여유 공간 확보
        const extraHeight = window.innerHeight; // 화면 한 높이만큼 추가
        video_sect.style.height = `${video_sect_height + extraHeight}px`;

        video_sect_top = video_sect.offsetTop;
      });

      // 스크롤에 따라 비디오 재생 시간 업데이트
      function updateVideoPlayback() {
        const scrollPosition = window.scrollY;

        if (!video_sect_top || !video_sect_height) return;

        const relativeScroll = scrollPosition - video_sect_top;

        if (relativeScroll >= 0 && relativeScroll <= video_sect_height) {
          const progress = Math.min(relativeScroll / video_sect_height, 1); // 최대값 제한
          video.currentTime = video.duration * progress;
          video.style.opacity = 1;
        }else if(relativeScroll >= 0 && relativeScroll > video_sect_height){
            video.style.opacity = 0;
        }
      }

      // 스크롤 이벤트 등록
      window.addEventListener("scroll", updateVideoPlayback);

      // Lenis 애니메이션 프레임 처리
      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    </script>
  </body>
</html>
